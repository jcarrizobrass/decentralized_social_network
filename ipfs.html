<!DOCTYPE html>
<html>
  <head>
    <title>JavaScript file upload</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script src="buffer.js"></script>

    <script src="https://unpkg.com/ipfs-api@9.0.0/dist/index.js"
    integrity="sha384-5bXRcW9kyxxnSMbOoHzraqa7Z0PQWIao+cgeg327zit1hz5LZCEbIMx/LWKPReuB"
    crossorigin="anonymous"></script>
  </head>

  <body>
 <h2>Social Network button test</h2>
    <h3>Browser Example</h3>
    <hr />
    <h4>Get IPFS Hash Data<h4>
    <input type="text" id="lookupHash"/>
    <button id="lookup">Lookup Block</button>
    <button id="lookupStats">Get Stats</button>
    <br /><br />
    <div id="lookupResponse"></div>
    <hr />
    <h4>Add String Data</h4>
    <textarea id="addInputData" placeholder="Hello world!"></textarea>
    <br />
    <button id="addData">Add Data</button>
    <div id="lookupResponse"></div>
    <hr />
    <h4>Add JSON Data</h4>
    <textarea id="addJSONdata" placeholder="Hello world!"></textarea>
    <br />
    <button id="addJSONData">Add JSON Data</button>
    <br /><br />
    <div id="addResponse"></div>
    <div id="lookupResponse"></div>
    <br />
    <br /><br />
    <div id="CreateUser"></div>
    <hr />
    <h4>Create User</h4>
     <h4>Name</h4>
    <textarea id="create_username" placeholder="Insert Name"></textarea><textarea id="create_lastname" placeholder="Insert lastname"></textarea>
    <h4>Email</h4>
    <textarea id="create_email" placeholder="Insert email"></textarea>
    <button id="create_user">Create User</button>


    <form action="/">
      <fieldset>
        <legend>Upload photo</legend>
        <input type="file" name="photo" id="photo">
        <button type="button" onclick="upload()">Upload</button>
      </fieldset>
    </form>
    </br>
    </br>
    <a id="url"></a>
    </br>
    </br>
    <img id="output">

  <script type="text/javascript" src="dist/ipfs-mini.js"></script>
    <script type="text/javascript">
      var el = function(id){ return document.querySelector(id); };
      var ipfs = new IPFS({ host: 'ipfs.infura.io', protocol: 'https' });




      el('#lookup').addEventListener('click', function(){
        var isJSON = false;
        var lookupHash = el('#lookupHash').value;

        ipfs.catJSON(lookupHash, (err, result) => {
          if (err) {
            el('#lookupResponse').innerHTML = 'Hmm.. there was an error: ' + String(err);
          } else {
            el('#lookupResponse').innerHTML = result;
          }
        });
      });



      el('#lookupStats').addEventListener('click', function(){
        var lookupHash = el('#lookupHash').value;

        ipfs.stat(lookupHash, (err, result) => {
          if (err) {
            el('#lookupResponse').innerHTML = 'Hmm.. there was an error: ' + String(err);
          } else {
            el('#lookupResponse').innerHTML = JSON.stringify(result, null, 2);
          }
        });
      });

      el('#addData').addEventListener('click', function(){
        var isJSON = false;
        var inputData = el('#addInputData').value;

        ipfs.add(inputData, (err, result) => {
          if (err) {
            el('#addResponse').innerHTML = 'Hmm.. there was an error: ' + String(err);
          } else {
            el('#addResponse').innerHTML = result;
          }
        });
      });
      el('#addJSONData').addEventListener('click', function(){
        var isJSON = true;
        var inputData = el('#addJSONdata').value;

        ipfs.addJSON(inputData, (err, result) => {
          if (err) {
            el('#addResponse').innerHTML = 'Hmm.. there was an error: ' + String(err);
          } else {
            el('#addResponse').innerHTML = result;
            console.log(result)
          }
        });
      });



// functions to work with solidity

     // var eth = new Eth(TestRPC.provider());
     // var el = function(id){ return document.querySelector(id); };
      
      // uncomment to enable MetaMask support:
      /*if (typeof window.web3 !== 'undefined' && typeof window.web3.currentProvider !== 'undefined') {
        eth.setProvider(window.web3.currentProvider);
      } else {
        eth.setProvider(provider); // set to TestRPC if not available
      
      
      var SocNetInst;

      //shareEvent
      el('#response').innerHTML = 'Share event...';
      SocNetInst.shareEvent(function(err, result){
        if (err) {
          el('#response').innerHTML = 'Hmm, there was an error ' + String(err);
        } else {
          el('#response').innerHTML = 'Sharing event: ' + String(result);
        }
      });

      //UserCollect
      el('#response').innerHTML = 'User collecting payment';
      SocNetInst.shareEvent(function(err, result){
        if (err) {
          el('#response').innerHTML = 'Hmm, there was an error ' + String(err);
        } else {
          el('#response').innerHTML = 'Payment collected: ' + String(result);
        }
      });

      //AddFriendsS
       el('#response').innerHTML = 'Add Friend...';
      SocNetInst.AddFriendsS(el('#friend').value, function(err, result){
        if (err) {
          el('#response').innerHTML = 'Hmm, there was an error ' + String(err);
        } else {
          el('#response').innerHTML = 'Adding friend: ' + String(result);
                    }
      });

       el('#addJSONData').addEventListener('click', function(){
        var username = el('#create_username').value;
        var lastname = el('#create_lastname').value;
        var email = el('#create_email').value;
        var user = [['username',username],['lastname', lastname],['email',email]];
        //need hashes address and create ipfs directiories
      });
    
*/


function CreateUser()
{
  var create_user = {"username":name1,"wallet":$('#bidAccount').val(),"email":email};
  var user = JSON.stringify(create_user);
  ipfs.addJSON(inputData, (err, result) => {
      if (err) {
            console.log(String(err));
          } else {
            console.log(String(result));
          }});
  user_ipfs = result;
 }

function Login(){
  ipfs.catJSON(ipfs_hash1, (err, result) => {
          if (err) {
            console.log(String(err));
          } else {
            console.log(String(result));
          }});
    return result;
}
    </script>

  </body>

    <script type="text/javascript">
    function upload() {
      const reader = new FileReader();
      reader.onloadend = function() {
        const ipfs = window.IpfsApi('localhost', 5001) // Connect to IPFS
        const buf = buffer.Buffer(reader.result) // Convert data into buffer
        ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
          if(err) {
            console.error(err)
            return
          }
          let url = `https://ipfs.io/ipfs/${result[0].hash}`
          console.log(`Url --> ${url}`)
          document.getElementById("url").innerHTML= url
          document.getElementById("url").href= url
          document.getElementById("output").src = url
        })
      }
      const photo = document.getElementById("photo");
      reader.readAsArrayBuffer(photo.files[0]); // Read Provided File
    }
  </script>
</html>
